<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/auth.css" />
  
 <title>Verify OTP</title>
</head>
<body>

  <%- include(`../partials/fonts`) %>

  <div id="up-t"></div>
  <div id="up-t2"></div>

  <div id="box-up"></div>

  <div id="login-wrap">
   <div id="login-box">
   </div>
  </div>

  <div id="box-down"></div>
  <div id="down-t"></div>
  <div id="down-t2"> </div>
  <div id="down-t3"> </div>
  <div id="down-t4"> </div>
 



 <% if (maskedPhone) { %>
  <p id="verify-title">OTP sent to WhatsApp number : <br><strong id="mask-no"><%= maskedPhone %></strong></p>
<% } %>

<div id="verify-form">

  <h2 id="verify-head">Enter OTP</h2>
 
  

 <form id="verify-otp" action="<%= otpAction %>" method="POST">
  <input type="hidden" name="verifyType" value="<%= verifyType %>">
  <input type="hidden" name="verifyID" value="<%= verifyID %>">
  <input id="verify-input" type="text" name="otp" placeholder="6-digit code">
  <% if (error) { %><p><%= error %></p><% } %><br>
  <button id="verify-btn" type="submit">verify</button>
</form>


<form id="resendForm" method="POST" action="/resend-otp">
 <input type="hidden" name="verifyType" value="<%= verifyType %>">
  <input type="hidden" name="verifyID" value="<%= verifyID %>">
  <p id="resend-otp">
    Didnâ€™t receive OTP?<br>
    <button type="submit" id="resendBtn">Resend</button><br>
    <span id="resendMsg" ></span>
  </p>
</form>
</div>

<script>
  const resendForm = document.getElementById("resendForm");
  const resendBtn = document.getElementById("resendBtn");
  const resendMsg = document.getElementById("resendMsg");
  let resendCountdown; // To clear existing interval

  resendForm.addEventListener("submit", function(e) {
    e.preventDefault(); // Prevent full page post

    if (resendBtn.disabled) return;
    resendBtn.disabled = true;
    resendBtn.textContent = "Sending...";

    const formData = new FormData(resendForm);

    fetch(resendForm.action, {
      method: "POST",
      body: new URLSearchParams(formData)
    })
    .then(response => {
      if (!response.ok) throw new Error("Failed to resend OTP");
      return response.text();
    })
    .then(() => {
      resendMsg.textContent = "OTP resent successfully.";
      startCountdown(30); // 30 second timer
    })
    .catch(() => {
      resendMsg.textContent = "Error resending OTP.";
      resendBtn.disabled = false;
      resendBtn.textContent = "Resend";
    });
  });

  function startCountdown(seconds) {
    if (resendCountdown) clearInterval(resendCountdown);
    let timeLeft = seconds;
    resendBtn.textContent = `Resend in ${timeLeft}s`;
    resendBtn.disabled = true;

    resendCountdown = setInterval(() => {
      timeLeft--;
      resendBtn.textContent = `Resend in ${timeLeft}s`;
      if (timeLeft <= 0) {
        clearInterval(resendCountdown);
        resendBtn.disabled = false;
        resendBtn.textContent = "Resend";
        resendMsg.textContent = "";
      }
    }, 1000);
  }
</script>



</body>
</html>